<div class="context-wrapper">
  <div class="context-left" id="context-left-box">
    <p-listbox [style]="{'width':'100%'}" [options]="systems" (onChange)="onSelect($event)"  optionLabel="systemName">
      <p-header>
        <p>시스템 목록</p>
      </p-header>
    </p-listbox>
  </div>
  <div class="context-right">
    <p-panel>
        <p-header>
            <div class="ui-helper-clearfix">
                <span class="ui-panel-title context-header-text" style="display:inline-block;margin-top:4px;font-weight:bold">
                  시스템 연결 정보
                </span>
                <p-button class="context-header-button" label="Save" icon="pi pi-check" (onClick)="save()"></p-button>
            </div>
        </p-header>
        <div class="form-input-text-box">
          <div><label>ID</label></div>
          <div><input type="text" style='width:70%' [(ngModel)]="selectedSystem.systemId" [disabled]="true" pInputText></div>

          <div><label>NAME</label></div>
          <div><input type="text" style='width:70%' [(ngModel)]="selectedSystem.systemName" pInputText></div>
          
          <div><label>DESCRIPTION</label></div>
          <div><input type="text" style='width:70%' [(ngModel)]="selectedSystem.systemDesc" pInputText></div>

          <div><label>URL</label></div>
          <div><input type="text" style='width:70%' [(ngModel)]="selectedSystem.systemUrl" pInputText></div>
          
        </div>
        <p-footer>
            
        </p-footer>
    </p-panel>

    <p-panel>
      <p-header>
          <div class="ui-helper-clearfix">
              <span class="ui-panel-title context-header-text" style="display:inline-block;margin-top:4px;font-weight:bold">
                시스템 스케줄러 정보
              </span>
          </div>
      </p-header>
      
      <p-dataView #dv [value]="schedulers">
          <ng-template let-scheduler pTemplate="listItem">
              <div class="p-grid context-scheduler-box">
                  <div class="p-col-5" >
                      <div class="p-grid">
                        <div class="p-col-3">ID</div>
                        <div class="p-col-1 context-label-seperator" >:</div>
                        <div class="p-col-8">{{scheduler.schedulerId}}</div>
                        <div class="p-col-3">Name</div>
                        <div class="p-col-1 context-label-seperator" >:</div>
                        <div class="p-col-8">{{scheduler.schedulerName}}</div>
                        <div class="p-col-3">Description</div>
                        <div class="p-col-1 context-label-seperator" >:</div>
                        <div class="p-col-8">{{scheduler.schedulerDesc}}</div>
                        <div class="p-col-3">Job Class</div>
                        <div class="p-col-1 context-label-seperator" >:</div>
                        <div class="p-col-8">{{scheduler.jobClass}}</div>
                      </div>             
                  </div>
                  <div class="p-col-5" >
                      <div class="p-grid">
                        <div class="p-col-5">실행 주기</div>
                        <div class="p-col-1 context-label-seperator" >:</div>
                        <div class="p-col-6">{{scheduler.triggerType}}</div>
                        <div class="p-col-5">실행 시간(월/주/시/분)</div>
                        <div class="p-col-1 context-label-seperator" >:</div>
                        <div class="p-col-6">{{scheduler.dayOfMonth}}/{{scheduler.dayOfWeek}}/{{scheduler.hourOfDay}}/{{scheduler.minuteOfHour}}</div>
                        <div class="p-col-5">마지막 실행 시간</div>
                        <div class="p-col-1 context-label-seperator" >:</div>
                        <div class="p-col-6">{{scheduler.lastExecuteDate}}</div>
                      </div> 
                  </div>
                  <div class="p-col-2 p-align-center vertical-container" >
                      <div class="p-grid">
                          <div class="p-col-12" >
                              <button class="context-scheduler-button-area" pButton type="button" icon="pi pi-check" label="실행 이력"   (click)="showSchedulerLog($event, scheduler)"></button>
                          </div>
                          <div class="p-col-12">
                              <button class="context-scheduler-button-area" pButton type="button" icon="pi pi-check" label="즉시 실행"  (click)="runSystemScheduler($event, scheduler)"></button>
                          </div>
                      </div>
                  </div>
              </div>
          </ng-template>
      </p-dataView>
      
      <p-footer>
      </p-footer>
    </p-panel>
    
    <p-panel header="테이블 연결 정보" [toggleable]="true" [style]="{'margin-bottom':'20px'}">
        <p-table [value]="systemColumns">
            <ng-template pTemplate="header">
                <tr>
                    <th>컬럼 이름</th>
                    <th>컬럼 아이디 </th>
                    <th>연결 컬럼</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-sysCol>
                <tr>
                    <td>{{sysCol.displayName}}</td>
                    <td>{{sysCol.columnName}}</td>
                    <td>{{sysCol.mappingColumn}}</td>
                </tr>
            </ng-template>
        </p-table>
    </p-panel>
      
  </div>
</div>

<p-dialog header="스케줄러 실행 이력" [(visible)]="displayDialog" [responsive]="true" [modal]="true" [style]="{'margin-left':'80px', 'margin-right':'80px'}"  (onAfterHide)="onDialogHide()">
    <div class="ui-g" *ngIf="selectedScheduler">       
        <p-table class="table-cell-center" [value]="schedulerHistorys">
            <ng-template pTemplate="header">
                <tr>
                    <th>실행 시간</th>
                    
                    <th>계정 생성 (성공/시도)</th>
                    <th>계정 변경 (성공/시도)</th>
                    <th>계정 삭제 (성공/시도)</th>
                    
                    <th>합계 (성공/시도)</th>
                    <th>상세 내용</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-history>
                <tr>
                    <td>{{history.workDate}}</td>

                    <td>{{history.resPut}}/{{history.reqPut}}</td>
                    <td>{{history.resPost + history.resPatch }}/{{history.reqPost + history.reqPatch}}</td>
                    <td>{{history.resDelete}}/{{history.reqDelete}}</td>
                    <td> {{history.resPut + history.resPost + history.resPatch + history.resDelete }}/{{history.reqPut + history.reqPost + history.reqPatch + history.reqDelete}}</td>
                    <td> <p-button label="Click" (onClick)="showDetailLog($event,history)"> </p-button> </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
    <p-paginator [rows]="10" [totalRecords]="100"></p-paginator>
</p-dialog>

<p-dialog header="상세 내용" [(visible)]="displayDetailDialog" [responsive]="true" [modal]="true" [style]="{'margin-left':'80px', 'margin-right':'80px'}"  (onAfterHide)="onDialogHide()">
    <div class="ui-g" *ngIf="selectedScheduler">       
       detail log ..
    </div>
    <p-paginator [rows]="10" [totalRecords]="100"></p-paginator>
</p-dialog>