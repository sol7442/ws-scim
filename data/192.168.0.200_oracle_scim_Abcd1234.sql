-- 시스템 테이블 ---

SELECT * FROM SCIM_SYSTEM;

--UPDATE SCIM_SYSTEM SET SYSTEMURL='http://192.168.0.198' WHERE USERID='75200659'
INSERT INTO SCIM_SYSTEM (SYSTEMID,SYSTEMNAME,SYSTEMDESC,SYSTEMURL,SYSTEMTYPE) 
VALUES ('sys-scim-hr','인사 시스템','현대 백화점 인사 시스템','http://192.168.0.198:5001','RESOURCE');




-- 사용자 테이블 --
SELECT * FROM SCIM_USER;
SELECT COUNT(*) FROM SCIM_USER;
SELECT * FROM SCIM_USER_PROFILE;
SELECT * FROM SCIM_USER WHERE USERID='52655939';
SELECT * FROM SCIM_USER_PROFILE WHERE USERID='52655939';
SELECT COUNT(*) FROM SCIM_USER_PROFILE; -- <== 320

SELECT * FROM SCIM_USER_PROFILE WHERE PKEY='employeeNumber' AND PVALUE IS NOT NULL;

SELECT * FROM SCIM_USER_PROFILE WHERE PKEY='retireDate' AND PVALUE IS NOT NULL;

SELECT count(*) FROM SCIM_USER_PROFILE;
UPDATE SCIM_USER SET MODIFYDATE='19/03/11' WHERE USERID='75200659'

UPDATE SCIM_USER_PROFILE SET PVALUE='111111111' WHERE USERID='52655939' AND PKEY='employeeNumber';

 
ALTER TABLE SCIM_USER ADD(PWCHANGEDATE DATE DEFAULT NULL); 
ALTER TABLE SCIM_USER MODIFY(MODIFYDATE DATETIME);

DELETE FROM SCIM_USER;
DELETE FROM SCIM_USER_PROFILE;

-- 시스템 사용자 테이블 --
SELECT * FROM SCIM_SYSTEM_USER;

SELECT * FROM SCIM_SYSTEM_USER WHERE SYSTEMID='sys-scim-sso' AND USERID='52655939';
SELECT COUNT(*) FROM SCIM_SYSTEM_USER;

ALTER TABLE SCIM_SYSTEM_USER ADD(PROVISIONDATE DATE DEFAULT NULL); 


DELETE FROM SCIM_SYSTEM_USER;
DELETE FROM SCIM_SYSTEM_USER_PROFILE;



-- 프로비저닝 대상자 --
-- 신규 대상자 <-- 고아 계정.
SELECT * FROM SCIM_USER A LEFT JOIN SCIM_SYSTEM_USER B ON A.USERID = B.USERID WHERE B.USERID IS NULL  AND A.ACTIVE = 1 AND B.SYSTEMID = 'sys-scim-sso';
-- 업데이트 <-- 
SELECT * FROM SCIM_USER A INNER JOIN SCIM_SYSTEM_USER B ON A.USERID = B.USERID WHERE B.SYSTEMID = 'sys-scim-sso' AND  A.MODIFYDATE > B.MODIFYDATE AND A.ACTIVE = 1;



//52655939

-- 관리자 테이블 --
SELECT * FROM SCIM_ADMIN;
INSERT INTO SCIM_ADMIN (ADMINID,ADMINNAME,ADMINTYPE) VALUES ('sys-admin','RELLY','OPERATOR');
ALTER TABLE SCIM_ADMIN ADD(ACTIVE NUMBER(10,0) DEFAULT 1); 
DELETE FROM SCIM_ADMIN WHERE ADMINID='ADMIN' --'61271125';

-- 스케줄러 --
SELECT * FROM SCIM_SCHEDULER;

SELECT * FROM SCIM_SCHEDULER;

INSERT INTO SCIM_SCHEDULER (SCHEDULERID,SCHEDULERNAME,SCHEDULERTYPE, SCHEDULERDESC, JOBCLASS, TRIGGERTYPE, HOUROFDAY, MINUTEOFHOUR, EXECUTESYSTEMID,SOURCESYSTEMID, TARGETSYSTEMID) 
VALUES ('sch-sync-hr','인사시스템 계정 동기화','RESOUREC_ANLYSYS', '인사 시스템의 계정을 IM 시스템으로 동기화한다.','com.ehyundai.im.ResourceSyncJob_Groupware','DAY', 1,1,'sys-scim-im','sys-scim-hr','sys-scim-im');

ALTER TABLE SCIM_SCHEDULER RENAME COLUMN EXCUTESYSTEMID TO EXECUTESYSTEMID;


UPDATE SCIM_SCHEDULER SET LASTEXECUTEDATE='18/01/01' WHERE SCHEDULERID='sch-sync-gw';
UPDATE SCIM_SCHEDULER SET LASTEXECUTEDATE='18/01/01' WHERE SCHEDULERID='sch-pro-sso';

UPDATE SCIM_SCHEDULER SET LASTEXECUTEDATE=null WHERE SCHEDULERID='sch-sync-gw';

DELETE FROM SCIM_SCHEDULER WHERE SCHEDULERID='sch-anl-sso';


-- 감사 데이터 --
SELECT * FROM SCIM_AUDIT ORDER BY WORKDATE;
SELECT * FROM SCIM_SCHEDULER_HISTORY;

SELECT count(*) FROM SCIM_AUDIT

SELECT * FROM SCIM_AUDIT WHERE userid='52655939' Order by WorkDate Desc;


DELETE FROM SCIM_AUDIT;
DELETE FROM SCIM_SCHEDULER_HISTORY;

ALTER TABLE SCIM_SCHEDULER_HISTORY ADD (WORKERID VARCHAR2(50 CHAR)); 
ALTER TABLE SCIM_SCHEDULER_HISTORY ADD(SUCCESSCOUNT NUMBER(10,0) DEFAULT 0); 
ALTER TABLE SCIM_SCHEDULER_HISTORY ADD(FAILCOUNT NUMBER(10,0) DEFAULT 0); 



ALTER TABLE SCIM_SCHEDULER_HISTORY DROP COLUMN REQPOST;
ALTER TABLE SCIM_SCHEDULER_HISTORY DROP COLUMN REQPUT;
ALTER TABLE SCIM_SCHEDULER_HISTORY DROP COLUMN REQDELETE;
ALTER TABLE SCIM_SCHEDULER_HISTORY DROP COLUMN REQPATCH;
ALTER TABLE SCIM_SCHEDULER_HISTORY DROP COLUMN RESPOST;
ALTER TABLE SCIM_SCHEDULER_HISTORY DROP COLUMN RESPUT;
ALTER TABLE SCIM_SCHEDULER_HISTORY DROP COLUMN RESDELETE;
ALTER TABLE SCIM_SCHEDULER_HISTORY DROP COLUMN RESPATCH;



DELETE FROM SCIM_AUDIT ;

ALTER TABLE SCIM_AUDIT ADD (WORKERTYPE VARCHAR2(50 CHAR)); 
ALTER TABLE SCIM_AUDIT ADD (ACTION VARCHAR2(50 CHAR)); 
ALTER TABLE SCIM_AUDIT RENAME COLUMN ADMINID TO WORKERID;
ALTER TABLE SCIM_AUDIT RENAME COLUMN DIRECTSYSTEM TO TARGETSYSTEMID;
ALTER TABLE SCIM_AUDIT RENAME COLUMN SOURCESYSTEM TO SOURCESYSTEMID;